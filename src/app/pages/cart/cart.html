<main class="container w-full h-full flex flex-col items-center justify-center py-8 mx-auto min-h-[calc(100vh-373px)]">
  @if (cartItems().length <= 0) { <!-- CARRINHO VAZIO -->
    <div class="flex flex-col mx-auto items-center mt-8">
      <lucide-angular [img]="bag" [size]="96" class="mb-2 my-icon text-[#808080]!"></lucide-angular>
      <div class="flex flex-col items-center">
        <h2 nz-typography class="text-wrap sm:text-nowrap text-center dark:text-white!">Seu carrinho está vazio</h2>
        <span nz-typography nzType="secondary" class="text-lg p-0 mb-4 text-center text-[#808080]!">Adicione produtos ao
          carrinho para continuar comprando</span>
        <a routerLink="/" class="text-decoration-none">
          <button class="py-3 px-6 bg-slate-900 dark:bg-white rounded-lg text-white w-fit cursor-pointer">
            <span class="text-white dark:text-black font-bold text-lg">Explorar Produtos</span>
          </button>
        </a>
      </div>
    </div>
    } @else {
    <section class="h-full flex flex-col w-full p-4">
      <h2 nz-typography class="text-nowrap dark:text-white!">Carrinho de Compras</h2>

      <div class="w-full flex flex-col md:flex-row gap-8 mt-6">
        <div
          class="cartItems border border-gray-200 dark:bg-zinc-800 dark:border-zinc-700 px-6 py-4 rounded-lg w-full md:max-w-[70%] h-fit">
          <div class="flex w-full justify-between items-center">
            <h4 nz-typography class="dark:text-white!">Itens ({{ cartItems().length }})</h4>
            <button (click)="clearCart()" class="group cursor-pointer">
              <span class="text-[#808080] font-semibold transition-all duration-200 hover:text-black">Limpar</span>
            </button>
          </div>

          <ul class="list-style-none">
            <!-- CART ITEM CARD -->
            <li *ngFor="let product of cartItems()" [id]="product!.id"
              class="product-cart-card flex gap-4 border-b border-gray-200 dark:border-zinc-700 py-4 px-2">
              <div class="h-24 w-24 flex-shrink-0 overflow-hidden rounded-lg bg-muted">
                <img nz-image [nzSrc]="product!.image_url" [nzFallback]="_productsService.imageFallback"
                  [alt]="product?.name" class="h-full w-full object-cover" />
              </div>
              <div class="w-full">
                <div class="flex w-full justify-between items-center">
                  <span [routerLink]="['/product', product.id]"
                    class="font-bold text-base dark:text-white cursor-pointer text-wrap sm:text-nowrap">{{ product.name
                    }}</span>
                  <button (click)="this._cartService.deleteCartItem(product.id)"
                    class="group p-2 rounded-lg hover:bg-gray-100 cursor-pointer">
                    <lucide-angular [img]="trash" [size]="18"
                      class="text-red-500 group-hover:text-gray-600"></lucide-angular>
                  </button>
                </div>
                <p class="text-[#808080]!">Camisetas</p>
                <div class="flex flex-col sm:flex-row gap-1 sm:gap-4">
                  <p class="text-[#808080]!" style="margin-bottom: 2px">
                    Tamanho: <span>{{ product!.size }}</span>
                  </p>
                  <div class="color flex items-center gap-1 mb-1">
                    <span class="text-[#808080]!">Cor: </span>
                    <div class="h-4 w-4 rounded-full border border-gray-200 p-0 m-0"
                      [style]="{ 'background-color': product.color }"></div>
                  </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-0 items-baseline sm:items-center justify-between">
                  <!-- QUANTITY INPUT -->
                  <div class="flex items-center rounded-lg border border-[#808080]">
                    <button
                      class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-gray-100 dark:hover:bg-zinc-700 h-8 w-8 cursor-pointer"
                      [disabled]="product.quantity <= 1">
                      <lucide-angular (click)="this._cartService.updateQuantity(product.id, '-')" [img]="minus"
                        [size]="16" class="text-black dark:text-white"></lucide-angular></button><span
                      class="w-10 text-center dark:text-white text-sm font-medium">{{
                      product.quantity
                      }}</span>
                    <button
                      class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-gray-100 dark:hover:bg-zinc-700 h-8 w-8 cursor-pointer">
                      <lucide-angular (click)="this._cartService.updateQuantity(product.id, '+')" [img]="plus"
                        [size]="16" class="text-black dark:text-white"></lucide-angular>
                    </button>
                  </div>
                  <!-- END QUANTITY INPUT -->
                  <span class="text-lg font-bold text-price dark:text-white">{{
                    _productsService.formatPrice(product.price * product.quantity)
                    }}</span>
                </div>
              </div>
            </li>
            <!-- CART ITEM -->
          </ul>
        </div>

        <div class="righCards flex flex-col w-full md:max-w-[30%] h-full gap-6">
          <!-- SHIPPING OPTIONS -->
          <div class="flex flex-col border border-gray-200 dark:bg-zinc-800 dark:border-zinc-700 p-6 rounded-lg">
            <div class="flex gap-3 items-center">
              <lucide-angular [img]="truck" [size]="20" class="dark:text-white"></lucide-angular>
              <span class="font-bold text-lg dark:text-white">Calcular Frete</span>
            </div>
            <div class="cep flex flex-col mt-4">
              <label for="cep" class="font-bold dark:text-white">CEP</label>
              <input type="text" mask="00000-000" placeholder="00000-000"
                class="h-10 rounded-lg border-1 border-gray-200 dark:border-zinc-700 dark:text-white! outline-none p-3 placeholder:text-[#808080]!" />

              <form novalidate class="shippingOptions" [formGroup]="shippingForm">
                <div class="flex flex-col gap-3 mt-4" formGroupName="shippingOption">
                  <button (click)="updateShippingOption('sedex')"
                    class="py-2 px-4 w-full flex justify-between items-center rounded-lg border border-gray-200 dark:border-zinc-700 hover:bg-gray-50 dark:hover:bg-zinc-700 transition-all duration-200 cursor-pointer">
                    <div class="flex gap-4">
                      <input formControlName="name" type="radio" value="sedex" id="shipping"
                        class="accent-black cursor-pointer" />
                      <div class="flex flex-col items-baseline">
                        <span class="font-bold text-base dark:text-white">SEDEX</span>
                        <span class="text-[#808080]! font-semibold">3 dias úteis</span>
                      </div>
                    </div>
                    <span class="font-bold text-base dark:text-white">R$ 25,00</span>
                  </button>

                  <button (click)="updateShippingOption('pac')"
                    class="py-2 px-4 w-full flex justify-between items-center rounded-lg border border-gray-200 dark:border-zinc-700 hover:bg-gray-50 dark:hover:bg-zinc-700 transition-all duration-200 cursor-pointer">
                    <div class="flex gap-4">
                      <input formControlName="name" type="radio" value="pac" id="shipping"
                        class="accent-black cursor-pointer" />
                      <div class="flex flex-col items-baseline">
                        <span class="font-bold text-base dark:text-white">PAC</span>
                        <span class="text-[#808080]! font-semibold">7 dias úteis</span>
                      </div>
                    </div>
                    <span class="font-bold text-base dark:text-white">R$ 15,00</span>
                  </button>

                  <button (click)="updateShippingOption('express')"
                    class="py-2 px-4 w-full flex justify-between items-center rounded-lg border border-gray-200 dark:border-zinc-700 hover:bg-gray-50 dark:hover:bg-zinc-700 transition-all duration-200 cursor-pointer">
                    <div class="flex gap-4">
                      <input formControlName="name" type="radio" value="express" id="shipping"
                        class="accent-black cursor-pointer" />
                      <div class="flex flex-col items-baseline">
                        <span class="font-bold text-base dark:text-white">Express</span>
                        <span class="text-[#808080]! font-semibold">1 dia útil</span>
                      </div>
                    </div>
                    <span class="font-bold text-base dark:text-white">R$ 35,00</span>
                  </button>
                </div>
              </form>
            </div>
          </div>
          <!-- END SHIPPING OPTIONS -->

          <!-- COUPON -->
          <div class="flex flex-col border border-gray-200 dark:bg-zinc-800 dark:border-zinc-700 p-6 rounded-lg">
            <div class="flex gap-3 items-center mb-2">
              <lucide-angular [img]="tag" [size]="20" class="dark:text-white"></lucide-angular>
              <span class="font-bold text-lg dark:text-white">Cupom de Desconto</span>
            </div>
            <div class="cep">
              <form novalidate class="flex flex-col lg:flex-row gap-2 w-full" [formGroup]="couponForm">
                <input type="text" formControlName="coupon" placeholder="Digite o cupom"
                  class="h-10 rounded-lg border-1 border-gray-200 dark:border-zinc-700 dark:text-white! outline-none py-3 px-4 placeholder:text-[#808080]! w-full uppercase placeholder:normal-case" />
                <button (click)="insertCoupon()"
                  class="py-2 px-4 border border-gray-200 rounded-lg transition-all duration-200 hover:bg-gray-50 dark:hover:bg-zinc-700 dark:border-zinc-700 cursor-pointer">
                  <span class="font-semibold dark:text-white">Aplicar</span>
                </button>
              </form>
            </div>
          </div>
          <!-- END COUPON -->

          <!-- ORDER RESUME -->
          <div class="flex flex-col border border-gray-200 dark:bg-zinc-800 dark:border-zinc-700 p-6 rounded-lg mb-4">
            <div class="flex gap-3 items-center">
              <span class="font-bold text-lg dark:text-white">Resumo do Pedido</span>
            </div>
            <div class="cep flex flex-col gap-2 pt-2 w-full">
              <div class="flex flex-col gap-2">
                <div class="subtotal flex w-full justify-between">
                  <span class="text-[#808080]! text-sm">Subtotal</span>
                  <span class="text-gray-800 dark:text-white text-sm">{{ formatCurrency(calculateSubTotalOrder())
                    }}</span>
                </div>
                <div class="shipping flex w-full justify-between">
                  <span class="text-[#808080]! text-sm">Frete</span>
                  <span class="text-gray-800 dark:text-white text-sm">R$
                    {{this.shippingForm.get('shippingOption.value')?.value || 25}},00</span>
                </div>
                <nz-divider style="margin-block: 6px" class="dark:bg-[#808080]!"></nz-divider>
                <div class="orderTotal flex w-full justify-between">
                  <span class="text-gray-950 dark:text-white text-lg font-bold">Total</span>
                  <span class="text-gray-950 dark:text-white text-lg font-bold">{{ formatCurrency(calculateTotalOrder())
                    }}</span>
                </div>
                <button (click)="completeOrder()"
                  class="py-3 px-4 bg-gray-800 dark:bg-white rounded-lg transition-all duration-200 hover:bg-gray-950 dark:hover:bg-zinc-300 cursor-pointer">
                  <span class="font-bold text-white dark:text-black">FINALIZAR COMPRA</span>
                </button>
              </div>
              <div class="flex w-full justify-center">
                <p class="text-[#808080]! text-xs">Parcelamento em até 12x sem juros</p>
              </div>
            </div>
          </div>
          <!-- END ORDER RESUME -->
        </div>
      </div>
    </section>
    }
</main>